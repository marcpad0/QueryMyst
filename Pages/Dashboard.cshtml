@page
@model QueryMyst.Pages.DashboardModel
@{
    ViewData["Title"] = "Your Dashboard";
}

<div class="hero-section dashboard-hero">
    <div class="hero-content">
        <h1 class="display-5 fw-bold">Welcome, @User.Identity?.Name!</h1>
        <p class="lead">Ready to solve some SQL mysteries?</p>
    </div>
</div>

<div class="container my-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0"><i class="bi bi-lightning-charge-fill me-2"></i> Your Progress</h5>
                </div>
                <div class="card-body">
                    <div class="row stats-row text-center">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="stat-item">
                                <div class="stat-number">@Model.MysteriesSolved</div>
                                <div class="stat-label">Mysteries Solved</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="stat-item">
                                <div class="stat-number">@Model.TotalQueriesWritten</div>
                                <div class="stat-label">SQL Queries Written</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-item">
                                <div class="stat-number">@Model.TotalBadges</div>
                                <div class="stat-label">Badges Earned</div>
                            </div>
                        </div>
                    </div>

                    <div class="progress-section mt-4">
                        <label class="form-label d-flex justify-content-between">
                            <span>Overall Progress</span>
                            <span>@Model.ProgressPercentage%</span>
                        </label>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-gradient-primary" role="progressbar" style="width: @Model.ProgressPercentage%" aria-valuenow="@Model.ProgressPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0"><i class="bi bi-trophy-fill me-2"></i> Recent Achievements</h5>
                </div>
                <div class="card-body">
                    @if (Model.RecentAchievements.Any())
                    {
                        <div class="achievement-list">
                            @foreach (var achievement in Model.RecentAchievements)
                            {
                                <div class="achievement-item">
                                    <div class="achievement-icon">@Html.Raw(achievement.Icon)</div>
                                    <div class="achievement-content">
                                        <h5 class="achievement-title">@achievement.Name</h5>
                                        <p class="achievement-desc">@achievement.Description</p>
                                    </div>
                                    <div class="achievement-date">@achievement.TimeAgoDisplay</div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-award text-muted" style="font-size: 2.5rem;"></i>
                            <p class="mb-0 mt-3">No achievements yet. Start solving mysteries to earn badges!</p>
                            <a href="/mysteries" class="btn btn-primary btn-sm mt-3">Find Mysteries to Solve</a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-4">
            @if (Model.FeaturedMystery != null)
            {
                <div class="card shadow mb-4">
                    <div class="card-header bg-gradient-primary text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i> Featured Mystery</h5>
                    </div>
                    <div class="card-body">
                        <div class="featured-mystery">
                            <div class="mystery-difficulty">
                                <span class="badge @(Model.FeaturedMystery.DifficultyClass ?? $"difficulty-{Model.FeaturedMystery.Difficulty?.ToLower() ?? "beginner"}")">
                                    @Model.FeaturedMystery.Difficulty
                                </span>
                            </div>
                            <h4 class="mystery-title">@Model.FeaturedMystery.Title</h4>
                            <p class="mystery-desc">@Model.FeaturedMystery.Description</p>
                            <div class="d-grid">
                                <a href="/Mysteries/Details/@Model.FeaturedMystery.Id" class="btn btn-primary">Solve This Mystery</a>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <div class="card shadow">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0"><i class="bi bi-people-fill me-2"></i> Leaderboard</h5>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        @foreach (var entry in Model.TopLeaderboard)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center @(entry.IsCurrentUser ? "active" : "")">
                                <div class="d-flex align-items-center">
                                    <div class="rank me-3">@entry.Rank</div>
                                    <div>@entry.UserName</div>
                                </div>
                                <span class="badge @(entry.IsCurrentUser ? "bg-white text-primary" : "bg-primary") rounded-pill">@entry.Score</span>
                            </li>
                        }
                    </ul>
                    <div class="card-footer text-center">
                        <a href="/leaderboard" class="text-decoration-none">View full leaderboard</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .dashboard-hero {
            background: linear-gradient(135deg, #6259ca, #4e36e2);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }
        
        .stat-item {
            padding: 1rem 0;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6259ca;
            line-height: 1.2;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .achievement-item:last-child {
            border-bottom: none;
        }
        
        .achievement-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            color: #6259ca;
        }
        
        .achievement-content {
            flex-grow: 1;
        }
        
        .achievement-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .achievement-desc {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 0;
        }
        
        .achievement-date {
            font-size: 0.75rem;
            color: #adb5bd;
        }
        
        .featured-mystery {
            padding: 0.5rem 0;
        }
        
        .mystery-title {
            font-size: 1.25rem;
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .mystery-desc {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 1.25rem;
        }
        
        .rank {
            font-weight: 700;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f3f9;
            border-radius: 50%;
        }
        
        .list-group-item.active {
            background-color: #eef2ff;
            border-color: #e5e9f2;
            color: #4e36e2;
        }
        
        .list-group-item.active .rank {
            background-color: rgba(78, 54, 226, 0.1);
        }

        .difficulty-beginner { background-color: #198754; color: white; }
        .difficulty-intermediate { background-color: #ffc107; color: black; }
        .difficulty-advanced { background-color: #fd7e14; color: white; }
        .difficulty-expert { background-color: #dc3545; color: white; }
    </style>
}